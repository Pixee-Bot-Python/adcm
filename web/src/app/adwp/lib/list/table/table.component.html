<mat-table matSort
           [multiTemplateDataRows]="!!expandedRow"
           [dataSource]="data"
           [trackBy]="trackBy"
           (matSortChange)="changeSort($event)"
           [matSortActive]="order?.active"
           [matSortDirection]="order?.direction">

  <mat-header-row *matHeaderRowDef="headerRow" [ngClass]="headerRowClassName"></mat-header-row>

  <mat-row
    adwpHover
    *matRowDef="let row; columns: headerRow"
    (click)="onClickRow(row, $event)"
    (auxclick)="onAuxclickRow(row, $event)"
    [ngClass]="{ 'select-table-item': currentId ? row.id === currentId : false, 'inactive': rowStatusChecker && rowStatusChecker(row) }"
  ></mat-row>

  <ng-container *ngIf="!!expandedRow">
    <mat-row [ngClass]="expandedRowClassName" *matRowDef="let row; columns: ['expandedRow']"></mat-row>
  </ng-container>

  <ng-container matColumnDef="expandedRow" *ngIf="!!expandedRow">

    <mat-header-cell *matHeaderCellDef></mat-header-cell>

    <mat-cell *matCellDef="let item" [attr.colspan]="ownColumns.length">
      <adwp-component-row
        [instanceTaken]="expandedRowInstanceTaken"
        [row]="item"
        [component]="expandedRow"
      ></adwp-component-row>
    </mat-cell>

  </ng-container>

  <ng-container [matColumnDef]="column.guid" *ngFor="let column of ownColumns">

    <mat-header-cell *matHeaderCellDef
                     [ngClass]="column.headerClassName"
                     [mat-sort-header]="column.sort"
                     [disabled]="!column.sort || !column.label">
      {{ column.label }}
      <ng-container *ngIf="column.type === 'choice'">
        <mat-checkbox
          (change)="onChooseAll($event)"
          [checked]="data | isAllChecked : column.modelKey"
          [indeterminate]="data | isIndeterminateChecked : column.modelKey"
          [disabled]="data | isMainCheckboxDisabled : column.disabled"
        ></mat-checkbox>
      </ng-container>
    </mat-header-cell>

    <mat-cell *matCellDef="let item"
              [ngClass]="column.className"
              (click)="clickOnCell({ event: $event, column: column })"
              [ngSwitch]="column.type">

      <ng-container *ngSwitchDefault>{{ item | listValue : column.value }}</ng-container>

      <ng-container *ngSwitchCase="'date'">{{ item | listValue : column.value | asString | time }}</ng-container>

      <ng-container *ngSwitchCase="'link'">
        <adwp-link-cell [row]="item" [column]="column"></adwp-link-cell>
      </ng-container>

      <ng-container *ngSwitchCase="'buttons'">
        <ng-container *ngFor="let button of column.buttons">
          <button mat-icon-button
                  color="primary"
                  [matTooltip]="button.tooltip"
                  (click)="invokeCallback(button.callback, item, $event)">
            <mat-icon>{{ button.icon }}</mat-icon>
          </button>
        </ng-container>
      </ng-container>

      <ng-container *ngSwitchCase="'dynamic-column'">
        <span [ngClass]="(item | calcDynamicCell : column.handle).cssClass">
          {{ (item | calcDynamicCell : column.handle).value }}
        </span>
      </ng-container>

      <ng-container *ngSwitchCase="'component'">
        <adwp-component-cell
          [component]="column.component"
          [row]="item"
          [column]="column"></adwp-component-cell>
      </ng-container>

      <ng-container *ngSwitchCase="'choice'">
        <mat-checkbox
          (click)="clickCheckbox($event)"
          (change)="onChoose({ row: item, event: $event })"
          [(ngModel)]="item[column.modelKey]"
          [disabled]="item | listCheckboxDisabled : column.disabled"
        ></mat-checkbox>
      </ng-container>

    </mat-cell>

  </ng-container>

</mat-table>
