- type: cluster
  version: &version 2.0
  name: downgrade_cluster_full
  upgrade:
    - name: switch_bundle_upgrade
      versions:
        min: 0.1
        max: 1.3
      scripts:
        - name: before_switch_job
          script: ./actions.yaml
          script_type: ansible
        - name: switch job
          script: bundle_switch
          script_type: internal
        - name: after_switch_job
          script: ./actions.yaml
          script_type: ansible
      states:
        available: any
        on_success: upgrading
  config: &config
    - name: string
      type: string
      required: false
    - name: int
      type: integer
      default: 12
    - name: secretmap
      type: secretmap
      default: {"first_key": "second_value"}
    - name: password
      type: password
      default: "second_pswd"
    - name: secrettext
      type: secrettext
      default: "second text"
    - name: secretfile
      type: secretfile
      default: ./secretfile
  actions:
    revert_upgrade:
      type: job
      script: bundle_revert
      script_type: internal
      states:
        available:
        - upgrading
    success_upgrade:
      type: job
      script: ./actions.yaml
      script_type: ansible
      states:
        available:
        - upgrading
        on_success: upgraded
    check_after_2: &action_2
      type: job
      script_type: ansible
      script: ./check_after_2.yaml
      states:
        available: any
      params:
        ansible_tags: cluster_after_2

- type: service
  version: *version
  name: service1
  config: *config
  actions:
    check_after_2:
      <<: *action_2
      params:
        ansible_tags: service_after_2
  components:
    component11:
      config: *config
      actions:
        check_after_2:
          <<: *action_2
          params:
            ansible_tags: component_after_2
