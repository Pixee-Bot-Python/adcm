- type: cluster
  version: &version 2.0
  name: downgrade_cluster
  upgrade:
    - name: switch_bundle_upgrade
      versions:
        min: 0.1
        max: 1.3
      scripts:
        - name: before_switch_job
          script: ./actions.yaml
          script_type: ansible
        - name: switch job
          script: bundle_switch
          script_type: internal
        - name: after_switch_job
          script: ./actions.yaml
          script_type: ansible
      states:
        available: any
        on_success: upgrading
  config: &config
    - name: string
      type: string
      required: true
      default: "string"
    - name: boolean
      type: boolean
      required: true
      default: false
    - name: float
      type: float
      required: true
      default: 1.0
  actions:
    revert_upgrade:
      type: job
      script: bundle_revert
      script_type: internal
      states:
        available:
        - upgrading
    success_upgrade:
      type: job
      script: ./actions.yaml
      script_type: ansible
      states:
        available:
        - upgrading
        on_success: upgraded

- type: service
  version: *version
  name: service1
  config: *config
  components:
    component11:
      config: *config
    component12:
      config: *config

- type: service
  version: *version
  name: service2
  config: &fullconf
    - name: string
      type: string
      required: true
      default: "string"
    - name: boolean
      type: boolean
      required: true
      default: false
    - name: float
      type: float
      required: true
      default: 3.0
    - name: integer
      type: integer
      required: true
      default: 17
    - name: list
      type: list
      required: true
      default:
        - /dev/rdisk0s4
        - /dev/rdisk0s5
        - /dev/rdisk0s6
    - name: map
      type: map
      required: true
      default:
        age: '25'
        name: John
        sex: m
    - name: option
      type: option
      required: true
      option:
        DAILY: DAILY
        WEEKLY: WEEKLY
      default: WEEKLY
    - name: structure
      type: structure
      required: true
      yspec: ./schema.yaml
      default:
        - code: 20
          country: Canada
        - code: 23
          country: Australia
        - code: 24
          country: China
  components:
    component21:
      config: *fullconf
    component22:
      config: *config
